# RotationAnalysis
Functions for analyzing noisy rotation time series (angle vs. time) with random
changes in direction of the rotation. Employs a deep learning based method (onedimensional
UNet) for semantic segmentation of time series into (counter-)clockwise segments and random
noise. Training data are synthesized via a linear model with capabilities for incorporating
different types of noise and changes in direction.

# Motivation & approach
The motivation for the development of this procedure comes from a problem encountered in
data analysis. The seemingly simple task was to analyze a rotation, represented by a time
series of an evolving angle, recovering as much information as possible, the bare minimum
being the speed of rotation.
However, simple approaches failed, as i. the data was extremely noisy, making numeric
differentiation impossible, and ii. because the rotation would change direction after random 
intervals, making it difficult to define regions for fitting. An example of unlabeled experimental
data is shown below:

![](https://github.com/adrianfessel/RotationAnalysis/blob/main/experimental.png?raw=true)

While other approaches such as simulated annealing with a polygon appear feasible,
experimentation with a neural network for semantic segmantation turned out expedient.
The idea pursued here is to generate synthetic data with features similar to the
experimental data, but known labels indicating whether a data point would belong
to i. clockwise rotation, ii. counter-clockwise rotation or iii. noise. This
synthetic data can be created using a simple model and, augmented with different
types of noise, serves as training data for a neural network. Using the trained
network, these labels can be 'recovered' for synthetic test data or for the real-world
data in question. 

# Contents
- training.py: neural network specification, data synthesis, data generator, training
- analysis.py: (moving window) segmentation, partitioning of segmented data
- demo.py: demonstration of data synthesis & segmentation

# Data synthesis
The function generates 1D time series of an angle changing with time, i.e. a rotation. It is assumed
that configurations shifted by pi cannot be distinguished, therefore the (wrapped) angle is 
bounded between 0..pi. At the basis, the angle is linearly dependent on time. However, after rotating
in one direction for a certain interval, the rotation may change direction. Rotation speed (slope) 
and average intervall length can be affected by additive noise via parameters.
Further, the time series can be affected by additive noise or by random noise, the latter meaning 
that single data points are assigned a random angle rather than one generated by the model.
Output data is labeled in the categories: (counter-)clockwise and random.

Shown below is an example of labeled synthetic data:

![](https://github.com/adrianfessel/RotationAnalysis/blob/main/synthetic_labels_original.png?raw=true)

Removing the labels illustrates the real problem. The data is extremely noisy, and even by ey it is
difficult to discern any type of structure:

![](https://github.com/adrianfessel/RotationAnalysis/blob/main/synthetic_unlabeled.png?raw=true)

# Segmentation
Employing the pretrained neural network recovers the label quite well. Some points that are labeled
as random noise in the original set of labels are indistinguishable from the points that are part of
the rotation if they fall into the same point clouds. For this reason, training accuracy is limited
but results are good nevertheless.
The parameters used to generate the example shown here are not identical to the parameters used for
generating the training set used for neural network training. Still, the neural network generalizes
sufficiently well to correctly segment the example.

![](https://github.com/adrianfessel/RotationAnalysis/blob/main/synthetic_labels_recovered.png?raw=true)

Based on the segmentation it is possible to partition the time series into sections associated with
counterclockwise or clockwise rotations. Using a method for parameter estimation that is robust to 
noise (RANSAC regression), it is possible to fit the sections with acceptable quality.

![](https://github.com/adrianfessel/RotationAnalysis/blob/main/synthetic_fits.png?raw=true)

The slope (rotation speed) recovered by the method matches the slope used for generation of the example.

![](https://github.com/adrianfessel/RotationAnalysis/blob/main/text.PNG?raw=true)

The trained network can be used to label the experimental data in the topmost figure. After partitioning
into sections, the same fitting routine as above can be applied:

![](https://github.com/adrianfessel/RotationAnalysis/blob/main/experimental_labeled_fits.png?raw=true)